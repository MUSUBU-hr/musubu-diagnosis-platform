# musubu-diagnosis-platform 仕様書

## 1. 目的

- 適職診断LPの提供
- 離脱ポイントの可視化
- 設問数・構成改善の判断材料取得
- 回答後にユーザー情報（氏名・LINE登録名）を取得

---

## 2. 機能要件

### 2.1 診断機能

- 全50問
- 10問ごとに1画面
- 全5ブロック構成

| ブロック | 設問範囲 |
|----------|----------|
| Block1   | Q1〜Q10  |
| Block2   | Q11〜Q20 |
| Block3   | Q21〜Q30 |
| Block4   | Q31〜Q40 |
| Block5   | Q41〜Q50 |

- 各ブロック回答後「次へ」ボタンで遷移
- Block5完了後、ユーザー情報入力画面へ遷移
- ユーザー情報入力完了後、診断結果表示

### 2.2 進捗管理

- ブロック単位で到達記録
- ページ遷移時にログ更新
- 再読込時も最大到達ブロックを保持

### 2.3 ユーザー情報入力

- Block5完了後に表示
- 入力項目：
  - 氏名（必須）
  - LINE登録名（必須）
- 入力完了後「結果を見る」ボタンで診断結果へ遷移

### 2.4 結果表示

- タイプ分類表示

※診断ロジック詳細は別紙扱い

---

## 3. 非機能要件

- スマホ最適化（最優先）
- 読み込み2秒以内
- ブロック間遷移はストレスなく

---

## 4. データ設計（最小構成）

### 4.1 テーブル：diagnosis_progress

| カラム     | 型        | 説明                     |
|------------|-----------|--------------------------|
| id         | STRING    | セッションID             |
| max_block  | INT       | 到達最大ブロック（1〜5） |
| completed  | BOOL      | 完走フラグ               |
| name       | STRING    | 氏名                     |
| line_name  | STRING    | LINE登録名               |
| created_at | TIMESTAMP | 開始日時                 |
| updated_at | TIMESTAMP | 更新日時                 |

### 4.2 更新ロジック

- 診断開始 → `max_block=1`
- Block2到達 → `max_block=2`
- …
- Block5完了 → `max_block=5`
- ユーザー情報入力完了 → `name, line_name, completed=true`

※単純上書き

---

## 5. 分析指標

管理画面で確認するもの：

- 診断開始数
- 完走率
- Block別到達率

### 5.1 Block到達率算出

```
Block2到達率 = Block2到達数 / 開始数
Block3到達率 = Block3到達数 / 開始数
...
```

→ 離脱箇所の可視化に使用
